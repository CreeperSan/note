<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>登錄</title>
        <link href="/stylesheets/style.css" rel="stylesheet">
        <script src="/lib/axios/axios.20200126.js"></script>
        <script src="/lib/cookie/cookie.20200126.js"></script>
        <script src="/lib/request/request.20200126.js"></script>
    </head>
    <body>
        <div style="display:flex;flex-direction:column;">
            <div style="display: flex;flex-direction: column;margin: 16px;border: solid 1px black;">
                <h3>Cookie</h3>
                <p id="info_user_id"></p>
                <p id="info_key"></p>
            </div>

            <!-- 登錄表格 -->
            <div style="display: flex;flex-direction: column;margin: 16px;border: solid 1px black;">
                <h3>登錄</h3>
                <label style="padding: 8px;">
                    <span style="padding: 8px 16px;">郵箱</span>
                    <input id="login_email" type="email" name="email" value="asd@email.com"/>
                </label>
                <label style="padding: 8px;">
                    <span style="padding: 8px 16px;">密碼</span>
                    <input id="login_password" type="email" name="email" value="5611100"/>
                </label>
                <button style="margin: 16px 32px;" onclick="login_click()">登錄</button>
                <button style="margin: 16px 32px;" onclick="login_auth()">验证</button>
            </div>


            <!-- 標簽列表 -->
            <div style="display: flex;flex-direction: column;margin: 16px;border: solid 1px black;">
                <h3>標簽列表 <a onclick="refresh_tag_list()">刷新</a> <a onclick="add_tag()">新增</a></h3>
                <div id="tag_div">
                </div>
            </div>


            <!-- 分類列表 -->
            <div style="display: flex;flex-direction: column;margin: 16px;border: solid 1px black;">
                <h3>分類列表</h3>
            </div>


            <!-- 筆記列表 -->
            <div style="display: flex;flex-direction: column;margin: 16px;border: solid 1px black;">
                <h3>筆記列表</h3>
            </div>


            <!-- Auth列表 -->
            <div style="display: flex;flex-direction: column;margin: 16px;border: solid 1px black;">
                <button onclick="print_auth()">刷新</button>
                <p id="auth">尚未刷新</p>
            </div>




        </div>

        <script>
            const COOKIE_USER_ID = "UserID"
            const COOKIE_KEY = "key"

            const USER_ID = Cookies.get(COOKIE_USER_ID)
            const KEY = Cookies.get(COOKIE_KEY)

            async function login_click() {
                let email = document.getElementById('login_email').value
                let password = document.getElementById('login_password').value

                let response = await post('/api/v1/user/login', {
                    email : email,
                    password : password,
                })
                if(response.success){
                    let data = response.data
                    console.log(data.id)
                    console.log(data.key)
                    Cookies.set(COOKIE_USER_ID, data.id)
                    Cookies.set(COOKIE_KEY, data.key)
                }else{
                    alert('登陆失败')
                }
            }
            async function login_auth() {
                let user_id = Cookies.get(COOKIE_USER_ID)
                let user_key = Cookies.get(COOKIE_KEY)

                let response = await post('/api/v1/user/auth')

                axios({
                    method  : 'post',
                    url     : '/api/v1/user/auth',
                    headers : {
                        id : user_id,
                        key : user_keyvbcv
                    }
                }).then(function (response) {
                    console.log(response.data);
                }).catch(function (error) {
                    alert(error)
                    console.log(error);
                })
            }

            function print_auth(){
                axios({
                    method  : 'post',
                    url     : '/auth',
                    headers : {
                        id      : USER_ID,
                        key     : KEY,
                    }
                }).then(function (response) {
                    console.log(response);
                    let json_str = JSON.stringify(response.data)
                    document.getElementById('auth').innerText = json_str
                }).catch(function (error) {
                    let json_str = JSON.stringify(response)
                    document.getElementById('auth').innerText = json_str
                    alert(error)
                    console.log(error);
                })
            }


            function refresh_tag_list(){
                axios({
                    method  : 'post',
                    url     : '/api/v1/tag/list',
                    headers : {
                        id      : Cookies.get(COOKIE_USER_ID),
                        key     : Cookies.get(COOKIE_KEY),
                    }
                }).then(function (response) {
                    console.log(response);
                    let tagDiv = document.getElementById('tag_div')
                    if(response.data.code === 200){
                        let dataStr = 'data : '
                        let list = response.data.data.list
                        for(let index in list){
                            let item = list[index]
                            dataStr = dataStr + '<br><a onclick="delete_tag('+item._id+')">删除</a>NAME:' + item.name + '____ID:' + item._id + '______UserID:' + item.user_id
                        }
                        tagDiv.innerHTML = dataStr
                    }else{
                        tagDiv.innerText = response.data.message
                    }
                }).catch(function (error) {
                    alert(error)
                    console.log(error);
                })
            }
            function delete_tag(id){

            }
            async function add_tag(){
                let tag_name = prompt('输入标签名称')
                if(!tag_name){
                    alert('名字输入错误')
                    return
                }
                let response = await post('/api/v1/tag/add', {
                    name : tag_name
                })
                if(response.success){
                    refresh_tag_list()
                }else{
                    console.log('添加失败')
                }
            }

            // 初始化Cookie

            document.getElementById('info_user_id').innerText = 'UserID : ' + Cookies.get(COOKIE_USER_ID)
            document.getElementById('info_key').innerText =  'Key : ' + Cookies.get(COOKIE_KEY)

        </script>
    </body>
</html>